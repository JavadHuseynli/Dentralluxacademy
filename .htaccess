# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP
# Dentalux Academy - Apache Configuration
# Security & Access Control
# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP

# Disable Directory Listing
Options -Indexes

# Enable FollowSymLinks
Options +FollowSymLinks

# Enable Rewrite Engine
<IfModule mod_rewrite.c>
    RewriteEngine On
</IfModule>

# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP
# PROTECT SENSITIVE FILES
# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP

# Protect configuration files
<FilesMatch "^(\.env|\.env\..*|config\.php|mail-config\.php|database\.php|credentials\.php)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Protect JSON data files
<FilesMatch "^(teacher\.json|upcoming-courses\.json|.*\.backup|.*\.bak)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Protect log files
<FilesMatch "\.(log|txt)$">
    <RequireAny>
        Require ip 127.0.0.1
        Require ip ::1
    </RequireAny>
</FilesMatch>

# Protect Git files
<FilesMatch "^\.git">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Protect htaccess and htpasswd
<FilesMatch "^\.ht">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP
# PROTECT DIRECTORIES
# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP

# Protect logs directory
<IfModule mod_rewrite.c>
    RewriteRule ^logs/ - [F,L]
</IfModule>

# Protect data directory (but allow JSON reading through PHP)
<IfModule mod_rewrite.c>
    RewriteRule ^data/.*\.json$ - [F,L]
</IfModule>

# Protect sessions directory
<IfModule mod_rewrite.c>
    RewriteRule ^sessions/ - [F,L]
</IfModule>

# Protect uploads directory from PHP execution
<Directory "uploads">
    php_flag engine off
    <FilesMatch "\.php$">
        Order Allow,Deny
        Deny from all
    </FilesMatch>
</Directory>

# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP
# SECURITY HEADERS
# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP

<IfModule mod_headers.c>
    # Prevent MIME type sniffing
    Header set X-Content-Type-Options "nosniff"

    # Prevent clickjacking
    Header set X-Frame-Options "SAMEORIGIN"

    # XSS Protection
    Header set X-XSS-Protection "1; mode=block"

    # Referrer Policy
    Header set Referrer-Policy "strict-origin-when-cross-origin"

    # Remove Server Signature
    Header unset Server
    Header unset X-Powered-By
</IfModule>

# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP
# PERFORMANCE & CACHING
# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP

# Enable Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser Caching
<IfModule mod_expires.c>
    ExpiresActive On

    # Images
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"

    # CSS and JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"

    # Fonts
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"

    # Videos
    ExpiresByType video/mp4 "access plus 1 year"

    # HTML (short cache for dynamic content)
    ExpiresByType text/html "access plus 1 hour"
</IfModule>

# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP
# ERROR PAGES
# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP

# Custom Error Pages (uncomment if you create them)
# ErrorDocument 404 /404.html
# ErrorDocument 403 /403.html
# ErrorDocument 500 /500.html

# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP
# PHP SETTINGS
# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP

<IfModule mod_php.c>
    # Hide PHP version
    php_flag expose_php Off

    # File upload limits
    php_value upload_max_filesize 10M
    php_value post_max_size 10M

    # Memory limit
    php_value memory_limit 256M

    # Session settings
    php_value session.cookie_httponly 1
    php_value session.cookie_secure 0
    php_value session.use_only_cookies 1
</IfModule>

# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP
# FILE ACCESS RESTRICTIONS
# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP

# Deny access to composer files
<FilesMatch "^(composer\.json|composer\.lock|package\.json|package-lock\.json)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Deny access to README and documentation in production
<FilesMatch "^(README\.md|CONTRIBUTING\.md|DEPLOYMENT\.md|.*\.md)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP
# RATE LIMITING (if mod_ratelimit is available)
# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP

<IfModule mod_ratelimit.c>
    # Limit download speed to prevent abuse
    <Location /video>
        SetOutputFilter RATE_LIMIT
        SetEnv rate-limit 400
    </Location>
</IfModule>

# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP
# CORS (if needed for API)
# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP

# <IfModule mod_headers.c>
#     <FilesMatch "\.(json|php)$">
#         Header set Access-Control-Allow-Origin "*"
#         Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
#         Header set Access-Control-Allow-Headers "Content-Type"
#     </FilesMatch>
# </IfModule>

# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP
# END
# PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP
